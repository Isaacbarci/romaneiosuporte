<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tabela Interativa com QR Code</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        /* Estilos permanecem os mesmos */
    </style>
</head>
<body>
    <h2>ROMANEIO DE SUPORTE</h2>
    <input type="text" id="identificacaoFilter" placeholder="Filtrar por QR ou Identificação" onkeyup="applyFilter()">
    <button onclick="downloadExcel()">Download Excel</button>
    <button onclick="startQrScanner()">Escanear QR Code</button>

    <div id="qr-container">
        <div id="qr-reader" style="width:300px; margin-top:10px;"></div>
        <button class="close-btn" onclick="stopQrScanner()">Fechar Scanner</button>
    </div>

    <table id="dataTable"></table>

    <div id="editModal" class="modal">
        <input type="hidden" id="editIndex">
        <label>Posição / TAG: <input type="text" id="POSICAOTAG" readonly></label>
        <label>Identificação 1: <input type="text" id="IDENTIFICACAO1" readonly></label>
        <label>Data do Romaneio: <input type="date" id="DATADOROMANEIO"></label>
        <label>Qtd Enviada: <input type="text" id="QTDENVIADA"></label>
        <label>Obs Romaneio: <input type="text" id="OBSROMANEIO"></label>
        <label>Qtde: <input type="text" id="Qtde" readonly></label>
        <label>Saldo: <input type="text" id="Saldo" readonly></label>
        <button class="save-btn" onclick="saveEdit()">Salvar</button>
        <button class="close-btn" onclick="closeModal()">Fechar</button>
    </div>

    <script>
        let data = [];
        let filteredData = [];
        let columnIndexes = {};
        let editedRows = new Set();
        let qrScanner;
        let workbook;

        const hiddenColumns = [
            "desenho suporte", "informações", "isométrico", "peso (kg)", "cond. pintura",
            "área superfície", "data corte", "data acoplamento", "data solda",
            "data jato/pintura", "número romaneio", "data romaneio", "data recebimento",
            "observação", "area m²", "data cadastro", "rev", "prog. fab.", "executante", "linha", "spool",
            "localização", "status", "peso", "qtde enviada", "qtde", "saldo", "tipo de suporte", "tipo estrutura", "id", "serviço"
        ];

        document.addEventListener("DOMContentLoaded", () => {
            const storedData = localStorage.getItem("uploadedData");
            if (storedData) {
                data = JSON.parse(storedData);
                filteredData = data.slice(1);
                findColumnIndexes();
                renderTable();
            } else {
                // Carregar o arquivo diretamente
                fetch('caminho/para/seu/arquivo.xlsx')
                    .then(response => response.arrayBuffer())
                    .then(arrayBuffer => {
                        workbook = XLSX.read(arrayBuffer, { type: 'array', cellFormula: true });
                        const sheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1, defval: "", raw: false });
                        data = jsonData;
                        localStorage.setItem("uploadedData", JSON.stringify(data));
                        filteredData = data.slice(1);
                        editedRows.clear();
                        localStorage.removeItem("editedRows");
                        findColumnIndexes();
                        renderTable();
                    });
            }

            const storedEditedRows = localStorage.getItem("editedRows");
            if (storedEditedRows) {
                editedRows = new Set(JSON.parse(storedEditedRows));
                renderTable();
            }
        });

        // Restante do código permanece o mesmo
    </script>
</body>
</html>